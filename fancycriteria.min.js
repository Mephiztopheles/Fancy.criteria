!function(){function a(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=b.call(a[c],c);if(void 0!==d)return d}return null}function b(a,b){return b?Fancy.getKey(a,b):a}function c(a){var c=b(a,this.key),e=d.conditions[this.type];return e&&"function"==typeof e?e(c,this.value):!1}function d(b){function e(a){return a.sort(function(a,b){var c=Fancy.getKey(a,l.q.sort.split(",")[0]),d=Fancy.getKey(b,l.q.sort.split(",")[0]),e=l.q.sort.split(",")[1];return"desc"===e?d>c:c>d})}function f(){k="",l.q={and:[],or:[],max:null,offset:null,sort:null}}function i(){function a(a){if(a.indexOf("and")>0){var b=[];return a.split(" and ").forEach(function(a){b.push(JSON.parse(a))}),b}return JSON.parse(a)}var b=k;f();for(var c in d)if(c.toUpperCase()===c){var e=new RegExp("OR \\S* "+d[c]+" ((?!"+h+").)*","g"),g=new RegExp("AND \\S* "+d[c]+" ((?!"+h+").)*","g"),i=b.match(e),j=b.match(g);i&&i.forEach(function(b){var e=b.match(/OR (\S*) /),f=b.trim().match(new RegExp(d[c]+" (.*)$"));if(e&&f)if(e=e[1],f=a(f[1]),"array"===Fancy.getType(f)){var g=[d[c],e];f.forEach(function(a){g.push(a)}),l.or.apply(l,g)}else l.or(d[c],e,f)}),j&&j.forEach(function(b){var e=b.match(/AND (\S*) /),f=b.trim().match(new RegExp(d[c]+" (.*)$"));if(e&&f)if(e=e[1],f=a(f[1]),"array"===Fancy.getType(f)){var g=[d[c],e];f.forEach(function(a){g.push(a)}),l.and.apply(l,g)}else l.and(d[c],e,f)})}var m=new RegExp("MAX (\\d*)(?=(?!"+h+").)*"),n=new RegExp("OFFSET (\\d*)(?=(?!"+h+").)*"),o=new RegExp("SORT (\\S*)(?=(?!"+h+").)*"),p=b.match(m),q=b.match(n),r=b.match(o);p&&p.forEach(function(a){var b=a.trim().match(/MAX (\w*)/);b&&(b=JSON.parse(b[1]),l.max(b))}),q&&q.forEach(function(a){var b=a.trim().match(/OFFSET (\w*)/);b&&(b=JSON.parse(b[1]),l.offset(b))}),r&&r.forEach(function(a){var b=a.trim().match(/SORT (.*)/);if(b){var c=b[1].split(",")[0],d=b[1].split(",")[1];l.sort(c,d)}})}function j(a,b,c,d){k&&(k+=" ");var e=[a,b];c&&e.push(c),void 0!==d&&e.push("array"===Fancy.getType(d)?d.join(" and "):d),k+=e.join(" ")}if("array"!==Fancy.getType(b))throw"Error: It doesn't make sense to search in "+Fancy.getType(b)+"s";if(this===Fancy)return new d(b);g||(g=!0,Fancy.version(this));var k,l=this;return Object.defineProperty(this,"query",{get:function(){return k},set:function(a){k=a,i()}}),f(),this.or=function(a,b,c){if(arguments.length>3){c=[c];for(var d in arguments)arguments.hasOwnProperty(d)&&parseInt(d)>2&&c.push(arguments[d])}return j("OR",b,a,"array"===Fancy.getType(c)?c.join(" and "):c),this.q.or.push({type:a,key:b,value:c}),this},this.and=function(a,b,c){if(arguments.length>3){c=[c];for(var d in arguments)arguments.hasOwnProperty(d)&&parseInt(d)>2&&c.push(arguments[d])}return j("AND",b,a,"array"===Fancy.getType(c)?c.join(" and "):c),this.q.and.push({type:a,key:b,value:c}),this},this.offset=function(a){return this.q.offset=a,j("OFFSET",a),this},this.max=function(a){return this.q.max=a,j("MAX",a),this},this.sort=function(a,b){return this.q.sort=a+","+b,j("SORT",this.q.sort),this},this.list=function(d){var f=[],g=b;if(l.q.sort&&(g=e(b)),g.forEach(function(b,e){var g=!0,h=0==l.q.or.length;a(l.q.and,function(){var a=c.call(this,b);return a?void 0:(g=!1,!1)}),a(l.q.or,function(){var a=c.call(this,b);return a?(h=!0,!1):void 0}),h&&g&&(d?f[e]=b:f.push(b))}),l.q.offset)for(var h=0;h<l.q.offset;)f.shift(),h++;return l.q.max&&f.splice(l.q.max),f},this.get=function(d){var f=b;return l.q.sort&&(f=e(b)),a(f,function(b){if(!(l.q.offset&&l.q.offset>b)){var e=this,f=!0,g=0==l.q.or.length;return a(l.q.and,function(){var a=c.call(this,e);return a?void 0:(f=!1,!1)}),a(l.q.or,function(){var a=c.call(this,e);return a?(g=!0,!1):void 0}),g&&f?d?{index:b.match(/^\d*$/)?parseInt(b):b,result:e}:e:void 0}})},this.copy=function(){var a=new d(b);return a.query=k,a},this}var e="FancyCriteria",f="0.0.4",g=!1,h="OR|MAX|OFFSET|AND|SORT";d.api=d.prototype={},d.api.version=f,d.api.name=e,d.LIKE="like",d.EQUALS="eq",d.LOWER_THAN="lt",d.LOWER_THAN_EQUALS="lte",d.GREATER_THAN="gt",d.GREATER_THAN_EQUALS="gte",d.BETWEEN="bt",d.NOT="not",d.NOTNULL="notnull",d.conditions={},d.conditions[d.LIKE]=function(a,b){return"null"!=typeof a&&"undefined"!=typeof a?a.toString().indexOf(b)>=0:!1},d.conditions[d.EQUALS]=function(a,b){return a===b},d.conditions[d.LOWER_THAN]=function(a,b){return b>a},d.conditions[d.LOWER_THAN_EQUALS]=function(a,b){return b>=a},d.conditions[d.GREATER_THAN]=function(a,b){return a>b},d.conditions[d.GREATER_THAN_EQUALS]=function(a,b){return a>=b},d.conditions[d.BETWEEN]=function(a,b){return a>b[0]&&a<b[1]},d.conditions[d.NOT]=function(a,b){return a!==b},d.conditions[d.NOTNULL]=function(a){return"undefined"!=typeof a&&null!==a},Fancy.criteria=d}();
//# sourceMappingURL=fancycriteria.min.js.map